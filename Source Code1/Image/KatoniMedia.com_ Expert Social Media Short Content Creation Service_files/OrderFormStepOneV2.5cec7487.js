import{d as Ce,r as s,g as Q,H as we,k as Se,o as xe,s as ne,K as Ie,a as S,c as D,b as g,e as le,h as n,f as c,j as V,i as p,t as q}from"./entry.ccfebbe1.js";import{u as _}from"./v4.9a3e6124.js";import{_ as f}from"./InputText.vue_vue_type_script_setup_true_lang.e9424c7f.js";import{c as ke,b as Ne,f as Te,h as Fe,B as Ve,v as Oe}from"./Button.cfdab3fe.js";import{_ as Ue}from"./InputSelect.vue_vue_type_script_setup_true_lang.0612f658.js";import{i as se}from"./IntlTel.7d5c59dd.js";import{Z as Ee,T as Pe,z as ze,w as De}from"./helpers.9a9d5058.js";import{g as Le,d as Re,b as Be,s as Ae,e as qe}from"./Attributions.46f38b13.js";import{f as _e}from"./funnel_event_helper.bd666bbb.js";import{F as $e}from"./FunnelServices.6e08424a.js";import{u as je}from"./index.98bfb2b5.js";import{_ as He}from"./Recaptcha.vue_vue_type_script_setup_true_lang.e4363a08.js";import{A as Me}from"./index.78c17736.js";import"./Countries.69e07731.js";import"./utils.c7339651.js";import"./MoonLoader.vue_vue_type_style_index_0_lang.15aaa70a.js";import"./HLConst.c4c5e8b3.js";import"./composables.6e31dd6d.js";import"./optimize_script.3eba72ba.js";const Ze={class:"info"},Je={key:0,class:"shipping"},Ke={class:"shipping-title-wrapp"},Qe={class:"address-title"},We=g("div",{class:"shipping-bar"},null,-1),Ge={class:"shipping-input-split"},Xe={key:1,class:"card-el-error-msg"},Ye={key:2,class:"recaptcha-container"},ea={key:0},aa={class:"order-form-footer"},wa=Ce({__name:"OrderFormStepOneV2",props:{step1:{type:Object,required:!0},extra:{type:Object,required:!0},isIntlTelScriptLoaded:{type:Boolean,required:!0}},emits:["goToSecondStep"],setup(o,{emit:oe}){const v=o,r=s([]),x=s(""),I=s(""),u=s(""),y=s(""),h=s(""),b=s(""),k=s(""),m=s(""),N=s(""),O=s(!1),d=s(""),C=s(""),T=s(),$=s(),L=je(),w=s(),U=s(),E=s(""),R=s(""),j=s(""),B=Q(()=>ke(v.extra)),W=we(),H=Q({get:()=>{if(!u.value)return"";try{const a=window.libphonenumber.parsePhoneNumberFromString(u.value,d.value);return a&&a.isValid()?a.formatNational():u.value}catch{return u.value}},set:a=>{try{const e=window.libphonenumber.parsePhoneNumberFromString(a,d.value);u.value=e.isValid()?e.number:a,d.value=e.country?e.country:d.value,T.value&&T.value.setCountry(d.value.toLowerCase())}catch{u.value=a}}}),ie=Q(()=>Ne()),re=Se();xe(async()=>{var a,e,t;C.value=L.value.locationId,d.value=L.value.locationCode;try{const l=await Te(re.baseUrl);l&&(d.value=l)}catch(l){console.error("Failed at header fetch:",l)}((a=v.step1)==null?void 0:a.enableCountryPicker)===!0&&v.isIntlTelScriptLoaded&&se(G),(t=(e=v.extra)==null?void 0:e.stickyContact)!=null&&t.value&&ne(async()=>{const l=await Fe(C.value,v.step1);l!=null&&l.filled&&(I.value=l.emailId,x.value=l.fullName,N.value=l.companyName,u.value=l.phoneNumber,h.value=l.city,b.value=l.state,y.value=l.address,k.value=l.zipcode,m.value=l.country)}),ue()}),Ie(()=>v.isIntlTelScriptLoaded,()=>{var a;((a=v.step1)==null?void 0:a.enableCountryPicker)===!0&&se(G)});const ue=()=>{const{full_name:a,company_name:e,email:t,phone:l,postal_code:P,address:z,state:M,city:Z,country:J}=W.query;a&&(x.value=a),e&&(N.value=e),t&&(I.value=t),l&&(u.value=l),Z&&(h.value=h),M&&(b.value=b),z&&(y.value=y),P&&(k.value=P),J&&(m.value=m)},G=()=>{var e;if(!$.value)return;let a=$.value.$el;T.value=(e=window==null?void 0:window.intlTelInput)==null?void 0:e.call(window,a,{preferredCountries:["us","gb","ca","au"],initialCountry:d.value||"us"}),a.addEventListener("countrychange",()=>{if(!T.value)return;const t=T.value.getNumber(),l=T.value.getSelectedCountryData().iso2;d.value=l?l.toUpperCase():"US",H.value=t})},de=()=>{var a,e;r.value=Oe(v.step1,N.value,x.value,I.value,u.value,d.value,y.value,k.value,m.value||((e=(a=w==null?void 0:w.value)==null?void 0:a.select)==null?void 0:e.value),h.value,b.value)},ce=async()=>{var a,e,t,l,P;if(de(),U.value&&!R.value){E.value="Invalid Captcha!";return}if(!r.value.length){O.value=!0;const z=_("msgsndr_id").value,M=_("am_id").value,Z=_("am_fingerprint").value,J=Le(C.value),ve=Re(C.value),A=Be(),me=L.value.funnelName||"funnel";let{domain:K,page_url:X}=W.query;K||(K=window.location.hostname,X=window.location.pathname);const{funnelPageId:Y,funnelId:ee,stepId:fe}=L.value,ae={eventType:"optin",domainName:K,pageUrl:X,funnelId:ee,pageId:Y,stepId:fe},ge={addressLine1:y.value,country:m.value||((e=(a=w==null?void 0:w.value)==null?void 0:a.select)==null?void 0:e.value),state:b.value,city:h.value,zip:k.value};A.medium=Me.OrderForm,A.mediumId=ae.stepId;const ye={lead:!0,eventData:A,source:me,pageId:Y,funnelId:ee,sessionId:J,funnelEventData:ae,sessionFingerprint:ve||null},F={locationId:C.value,name:x.value,phone:u.value,email:((t=I.value)==null?void 0:t.toLowerCase())||"",companyName:N.value,address:ge,attribution:ye,timezone:Ee(),amId:M,amFingerprint:Z,orderFormType:"two_step_form_submission",captchaToken:U.value?R.value:void 0};B.value.enableStickyContact&&(F.attribution.fingerprint=z,F.attribution.funnelEventData.fingerprint=z),B.value.enableForceCreate&&(F.attribution.forceCreate=!0),B.value.enableEmailValidation&&(F.attribution.session_d=Number(B.value.enableEmailValidation)||0);try{const i=await $e.createContact(F);if(!i)throw new Error("Something went wrong. Please try again later.");if(z!==i.fingerprint){const be=_("msgsndr_id",{path:"/",maxAge:31536e3});be.value=i.fingerprint}Pe();const he=ze(i);De("_ud",he),ne(()=>{_e("track","SubmitApplication")});let te=i.sessionFingerprint;A&&(Ae({sessionId:i.sessionId||null,locationId:C.value}),te&&qe(C.value,te)),O.value=!1,oe("goToSecondStep",{...F,id:i.id,sessionId:i.sessionId}),U.value=!1}catch(i){i.response.status===429&&(U.value=!0),j.value=(P=(l=i==null?void 0:i.response)==null?void 0:l._data)==null?void 0:P.message,O.value=!1,console.error(i)}}},pe=a=>{if(!a){E.value="Verification failed! Please try again";return}E.value="",R.value=a};return(a,e)=>(S(),D("div",null,[g("section",Ze,[o.step1.showCompanyName?(S(),le(f,{key:0,value:n(N),disabled:!1,placeholder:o.step1.companyName||"",class:c({input:!0,"is-danger":n(r).indexOf("companyname")>-1}),name:"companyname","onUpdate:modelValue":e[0]||(e[0]=t=>N.value=t)},null,8,["value","placeholder","class"])):V("",!0),p(f,{value:n(x),placeholder:o.step1.fullName,disabled:!1,class:c({input:!0,"is-danger":n(r).indexOf("name")>-1}),name:"name","onUpdate:modelValue":e[1]||(e[1]=t=>x.value=t)},null,8,["value","placeholder","class"]),p(f,{value:n(I),placeholder:o.step1.email||"",disabled:!1,class:c({input:!0,"is-danger":n(r).indexOf("email")>-1}),name:"email",autocomplete:"new","onUpdate:modelValue":e[2]||(e[2]=t=>I.value=t.trim())},null,8,["value","placeholder","class"]),o.step1.showPhone?(S(),le(f,{key:1,value:n(H),type:"tel",placeholder:o.step1.phone||"",disabled:!1,class:c({input:!0,"is-danger":n(r).indexOf("phone")>-1}),autocomplete:"off",name:"phone",ref:t=>$.value=t,"onUpdate:modelValue":e[3]||(e[3]=t=>H.value=t)},null,8,["value","placeholder","class"])):V("",!0)]),o.step1.showShipping?(S(),D("section",Je,[g("div",Ke,[g("div",Qe,q(o.step1.shippingHeadline),1),We]),p(f,{value:n(y),placeholder:o.step1.address||"",disabled:!1,class:c({input:!0,"is-danger":n(r).indexOf("address")>-1}),name:"address","onUpdate:modelValue":e[4]||(e[4]=t=>y.value=t)},null,8,["value","placeholder","class"]),p(f,{value:n(h),placeholder:o.step1.city||"",disabled:!1,class:c({input:!0,"is-danger":n(r).indexOf("city")>-1}),name:"city","onUpdate:modelValue":e[5]||(e[5]=t=>h.value=t)},null,8,["value","placeholder","class"]),g("div",Ge,[p(f,{value:n(b),placeholder:o.step1.state||"",disabled:!1,class:c({input:!0,"is-danger":n(r).indexOf("state")>-1}),name:"state","onUpdate:modelValue":e[6]||(e[6]=t=>b.value=t)},null,8,["value","placeholder","class"]),p(f,{value:n(k),placeholder:o.step1.zipCode||"",disabled:!1,class:c({input:!0,"is-danger":n(r).indexOf("zipcode")>-1}),name:"zipcode","onUpdate:modelValue":e[7]||(e[7]=t=>k.value=t)},null,8,["value","placeholder","class"])]),p(Ue,{value:n(m),options:n(ie),selected:n(m),class:c({input:!0,"is-danger":n(r).indexOf("country")>-1}),name:"country",placeholder:"Select Country ",ref_key:"countryPicker",ref:w,"onUpdate:modelValue":e[8]||(e[8]=t=>m.value=t)},null,8,["value","options","selected","class"])])):V("",!0),n(j)?(S(),D("span",Xe,q(n(j)),1)):V("",!0),n(U)?(S(),D("section",Ye,[p(He,{onExpired:e[9]||(e[9]=()=>R.value=""),onVerify:pe}),n(E)?(S(),D("p",ea,q(n(E)),1)):V("",!0)])):V("",!0),g("section",null,[p(Ve,{invisible:n(O),text:o.step1.btnText,"sub-text":o.step1.btnSubText,"button-style":o.extra.buttonStyle,onClick:ce,loading:n(O)},null,8,["invisible","text","sub-text","button-style","loading"])]),g("section",aa,[g("span",null,q(o.step1.footerText),1)])]))}});export{wa as default};
