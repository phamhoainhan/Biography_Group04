import{k as ie,d as ge,r as s,K as ae,I as Se,g as x,u as be,a as j,c as $,w as le,h as u,v as me,b as K,n as se,f as _e,F as Pe,o as Be,s as Te,C as Ve,i as fe,j as ye,_ as je}from"./entry.ccfebbe1.js";import{u as ke}from"./index.98bfb2b5.js";import{b as $e}from"./FunnelServices.6e08424a.js";import{u as Ae}from"./index.f9b9bd79.js";import{a as Ee,u as he}from"./v4.9a3e6124.js";import{u as Le}from"./composables.6e31dd6d.js";import{$ as Ue,g as we,x as Ce,S as qe}from"./helpers.9a9d5058.js";import{V as Ie,o as Re,i as De}from"./optimize_script.3eba72ba.js";import"./components.3b8e1ae5.js";import"./HLConst.c4c5e8b3.js";import"./Attributions.46f38b13.js";import"./index.78c17736.js";const Fe=()=>({channel:"APP",source:"WEB_USER",version:"2021-04-15"}),Oe=f=>{const d=ie().public;return Ue.create({baseURL:f||d.REST_API_URLS,headers:Fe()})},Me={getAvailableFormats:f=>Oe()("/medias/formats",{params:{id:f},method:"GET"})},He=["id","autoplay","muted"],Ne=["src"],ze=["src","type"],Je=ge({__name:"EncodedVideo",props:{videoId:{type:String,required:!0},fileId:{type:String,required:!0},url:{type:String,required:!0},properties:{type:Object,required:!0},fallback:{type:Object,required:!0},checkStep:{type:Object,required:!0},thumbnail:{type:String,default:()=>""}},async setup(f){var p;let d,O;const l=f,{getNextFunnelStepURL:G}=Ae(),y=s(),Q=s(""),M=s(!1);ae([y,M],()=>{var o,t;((o=y==null?void 0:y.value)==null?void 0:o.clientWidth)&&M.value&&l.thumbnail&&(Q.value=we(l.thumbnail,(t=y==null?void 0:y.value)==null?void 0:t.clientWidth),y.value.style.background=`url(${Q.value}) center center/cover`)},{immediate:!0});const H=[53,32,16],{data:U}=([d,O]=Se(async()=>Ee(`${l.videoId}`,async o=>{var t;try{if(!l.fileId)return{formats:H};const i=await Me.getAvailableFormats(l.fileId);let c=H;return(t=i==null?void 0:i.formats)!=null&&t.length&&(c=i.formats),{formats:c}}catch(i){return console.error(i),{formats:H}}})),d=await d,O(),d),J=s((p=U==null?void 0:U.value)==null?void 0:p.formats),ee=x(()=>{var t;const o=J.value||H;return(t=l.url)==null?void 0:t.replace("AVAILABLE_FORMATS",o.join(","))}),P=()=>{M.value=!0,h.value&&N()},h=x(()=>{var o,t;return((o=l.properties)==null?void 0:o.autoplay)===void 0?!0:(t=l.properties)==null?void 0:t.autoplay}),{$bus:te}=be(),W=s(0),X=ie(),g=s(),n=ke(),b=s(!1);n.value.videoExistsInPage=!0;const C=s(!0),a=s(),B=s(!1),q=s(!1),T=s(),R=s({fluid:!0,autoplay:h.value?"muted":!1,muted:h.value,controls:!0,loop:!1,playbackRates:l.properties.playBackSpeed?[.5,1,1.5,2]:!1,userActions:{doubleClick:!1},controlBar:{fullscreenToggle:l.properties.showFullScreenToggle===void 0?!0:l.properties.showFullScreenToggle,remainingTimeDisplay:l.properties.showPendingTime||!1,progressControl:l.properties.showProgressBar===void 0?!0:l.properties.showProgressBar,playToggle:l.properties.allowPlayPause||!1,volumePanel:!0}}),D=s(!1),V=o=>(o.preventDefault(),!1),N=()=>{a.value?setTimeout(()=>{var o;(o=a==null?void 0:a.value)==null||o.play()},50):a.value?W.value<3&&setTimeout(()=>{W.value++,N()},1e3):oe(),D.value=!0},Y=["https://stcdn.leadconnectorhq.com/videojs/7.20.3/video.min.js","https://stcdn.leadconnectorhq.com/videojs/ie8/1.1.2/videojs-ie8.min.js","https://stcdn.leadconnectorhq.com/videojs/7.20.3/videojs-http-streaming.min.js","https://stcdn.leadconnectorhq.com/videojs/videojs-hls-quality-selector/1.1.4/videojs-hls-quality-selector.min.js","https://stcdn.leadconnectorhq.com/videojs/videojs-contrib-quality-levels/2.2.0/videojs-contrib-quality-levels.min.js"],oe=()=>{{const o=window.videojs;Re(()=>{Le({link:[{rel:"stylesheet",href:"https://stcdn.leadconnectorhq.com/videojs/7.20.3/video-js.css"}]}),De(o?[]:Y,()=>{Z().then(()=>{N()})})})}},Z=()=>new Promise(async(o,t)=>{var k,w,I,S;g.value=JSON.parse(Ce("_ud"));const i=(k=l.checkStep)==null?void 0:k.checkStep,c=(I=(w=l.checkStep)==null?void 0:w.step)==null?void 0:I.value,m=/iPhone|iPad|iPod/i.test(navigator.userAgent)||["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform),_=/Android|webOS|BlackBerry|BB|PlayBook|IEMobile|Windows Phone|Kindle|Silk|Opera Mini/i.test(navigator.userAgent);if(!m&&!_?T.value="desktop":m?T.value="iphone":_&&(T.value="android"),!((S=g.value)!=null&&S.customer_id)&&i&&c){const r=G(c);window.location.href=r}A("init","page"),document.body.onclick=()=>{},await fetch(ee.value).then(r=>{(r==null?void 0:r.status)&&r.status!==200&&(C.value=!1)}).catch(r=>{console.warn("Video not available in encoded format! using fallback"),C.value=!1,t()}),a.value=videojs(`${l.videoId}-video-js`,R.value,()=>{});try{a.value.hlsQualitySelector()}catch(r){console.warn(r),t()}a.value.on("click",()=>{e.value=!0,R.value.controlBar.playToggle||a.value.play()}),a.value.on("ended",async()=>{q.value||(A("completed","player"),q.value=!0)}),a.value.on("abort",async()=>{A("abort","player")}),a.value.on("error",async()=>{A("error","player")}),a.value.on("play",async()=>{if(e.value=!1,!R.value.controlBar.playToggle)if(B.value===!1)B.value=!0;else return;q.value||A("play","player")}),a.value.on("pause",async r=>{var z,E,L,ne,re,ue,ce,de;let v=(ne=(L=(E=(z=a.value)==null?void 0:z.controlBar)==null?void 0:E.progressControl)==null?void 0:L.seekBar)==null?void 0:ne.progress_;if(!v){const ve=(ue=(re=a.value)==null?void 0:re.cache_)==null?void 0:ue.currentTime,pe=(de=(ce=a.value)==null?void 0:ce.cache_)==null?void 0:de.duration;ve&&pe?v=ve/pe:v=0}v>=.98||A("pause","player")}),T.value!=="desktop"?window.addEventListener("blur",r=>{r.preventDefault(),b.value||F("page"),b.value=!0}):(window.addEventListener("beforeunload",r=>{b.value||F("page"),b.value=!0}),window.addEventListener("pagehide",r=>{b.value||F("page"),b.value=!0})),te.$on("handle-redirect",()=>{T.value!=="desktop"&&!q.value&&(b.value||F("page"),b.value=!0)}),o(a.value)}),A=(o,t)=>{var i,c,m,_,k,w,I,S,r;try{let v=(_=(m=(c=(i=a.value)==null?void 0:i.controlBar)==null?void 0:c.progressControl)==null?void 0:m.seekBar)==null?void 0:_.progress_;if(!v){const E=(w=(k=a.value)==null?void 0:k.cache_)==null?void 0:w.currentTime,L=(S=(I=a.value)==null?void 0:I.cache_)==null?void 0:S.duration;E&&L?v=E/L:v=0}const z={fingerprint:he("msgsndr_id").value,contactId:n.value.contactId||((r=g==null?void 0:g.value)==null?void 0:r.customer_id),funnelId:n.value.funnelId,locationId:n.value.locationId,stepId:n.value.stepId,pageId:n.value.funnelPageId,domain:n.value.domain,path:n.value.pageUrl,event:o,videoUrl:l.fallback.url,videoId:l.fileId,progress:v,autoplay:h.value,userAgent:navigator.userAgent,device:T.value,eventType:t,version:1,email:n.value.email,phone:n.value.phone};qe.createFunnelVideoEvent(z)}catch(v){console.error(v)}},F=o=>{var t,i,c,m,_,k,w,I,S;if(!q.value){navigator.sendBeacon||A("close",o);try{const r=`${X.STATS_API_URL}/stats/video/event/beacon`;let v=(m=(c=(i=(t=a.value)==null?void 0:t.controlBar)==null?void 0:i.progressControl)==null?void 0:c.seekBar)==null?void 0:m.progress_;if(!v){const E=(k=(_=a.value)==null?void 0:_.cache_)==null?void 0:k.currentTime,L=(I=(w=a.value)==null?void 0:w.cache_)==null?void 0:I.duration;E&&L?v=E/L:v=0}const z={fingerprint:he("msgsndr_id").value,contactId:n.value.contactId||((S=g==null?void 0:g.value)==null?void 0:S.customer_id),funnelId:n.value.funnelId,locationId:n.value.locationId,stepId:n.value.stepId,pageId:n.value.funnelPageId,domain:n.value.domain,path:n.value.pageUrl,event:"close",videoUrl:l.fallback.url,videoId:l.fileId,progress:v,autoplay:h.value,userAgent:navigator.userAgent,device:T.value,eventType:o,version:1,email:n.value.email,phone:n.value.phone};navigator.sendBeacon(r,JSON.stringify(z))}catch{console.warn("Unload beacon failing")}}},e=s(!1);return(o,t)=>(j(),$(Pe,null,[le(K("div",{ref_key:"thumbnailContainer",ref:y,class:"hosted-video-thumbnail",onClick:t[0]||(t[0]=i=>N()),style:se({paddingBottom:"56.25%"})},null,4),[[u(Ie),P],[me,l.thumbnail&&!u(D)&&!u(h)||!u(a)]]),le(K("div",{onClick:t[1]||(t[1]=i=>e.value=!0),onTouchstart:t[2]||(t[2]=i=>e.value=!0)},[K("video",{id:`${f.videoId}-video-js`,class:_e(["vjs-big-play-centered video-js vjs-default-skin",{autoplay:u(h)}]),onContextmenu:V,playsinline:"",autoplay:u(h),muted:u(h)},[u(C)?(j(),$("source",{key:0,src:u(ee),type:"application/x-mpegURL"},null,8,Ne)):(j(),$("source",{key:1,src:l.fallback.url,type:l.fallback.type},null,8,ze))],42,He)],544),[[me,(!l.thumbnail||u(D)||u(h))&&u(a)]])],64))}});const We=["id"],Ke={key:1},Ge=["id"],Qe=["id"],Xe=["src"],Ye={key:1,class:"video-icon"},Ze=ge({__name:"Video",props:["element","classData","popup"],setup(f){const d=f,O=ke(),l=ie(),{$bus:G}=be(),{extra:y}=d.element,{thumbnailURL:Q,embedURL:M,customEmbedCode:H,autoplay:U,type:J,width:ee}=y.videoProperties.value,P=s("");M&&(P.value=M);const h=J==="custom_embed",te=J==="youtube",W=J==="selfHosted",X=s(""),g=s({}),n=s({}),b=s({}),C=s("");let a=s(`${d.element.id}-${new Date().getTime()}`);const B=s(!1),q=s(!1),T=s(),R=s(""),D=s(!1),V=s();W&&oe(y);const N=x(()=>{var e,p,o,t;try{const i=parseInt(((t=(o=(p=(e=d==null?void 0:d.element)==null?void 0:e.extra)==null?void 0:p.videoProperties)==null?void 0:o.value)==null?void 0:t.width)||100);return i===50?"w-1-2":i===75?"w-3-4":"w-100"}catch{return"w-100"}}),Y=x(()=>56.25);function oe(e){var i,c,m,_,k,w,I,S;const p=((m=(c=(i=e==null?void 0:e.videoProperties)==null?void 0:i.value)==null?void 0:c.selfHostedVideo)==null?void 0:m.id)||"",o=O.value.locationId,t=((w=(k=(_=e==null?void 0:e.videoProperties)==null?void 0:_.value)==null?void 0:k.selfHostedVideo)==null?void 0:w.thumbnail)||"";T.value=t,g.value=((S=(I=e==null?void 0:e.videoProperties)==null?void 0:I.value)==null?void 0:S.selfHostedVideo)||{},C.value=p,X.value=l.HLS_URL+`/hls/medias/${o}/media/transcoded_videos/${C.value}_,AVAILABLE_FORMATS,00k.mp4.urlset/master.m3u8`,n.value=e==null?void 0:e.playBackControls,b.value=e==null?void 0:e.checkStep}function Z(){if(d.popup){const e=P.value.replace("autoplay=1","autoplay=0");a.value="",setTimeout(()=>{P.value=e,a.value=`${d.element.id}-${new Date().getTime()}`},500)}}ae([V,D],()=>{var e,p;((e=V==null?void 0:V.value)==null?void 0:e.clientWidth)&&D.value&&(R.value=we(Q,(p=V==null?void 0:V.value)==null?void 0:p.clientWidth))},{immediate:!0});const A=()=>D.value=!0;Be(()=>{G.$on("closing-popup",Z),P.value||(B.value=!0),Te(()=>{setTimeout(()=>{q.value=!0},2500),setTimeout(()=>{var p,o,t,i,c,m;const e=O.value.mobileDevice;e&&!((t=(o=(p=d.element.extra)==null?void 0:p.visibility)==null?void 0:o.value)!=null&&t.hideMobile)&&U===1&&(B.value=!0),!e&&!((m=(c=(i=d.element.extra)==null?void 0:i.visibility)==null?void 0:c.value)!=null&&m.hideDesktop)&&U===1&&(B.value=!0)},3e3)})}),Ve(()=>{G.$off("closing-popup",Z)});function F(e){e.preventDefault(),e.stopPropagation(),B.value=!0,P.value=P.value.replace("autoplay=0","autoplay=1")}return ae(()=>O.value.mobileDevice,e=>{e&&setTimeout(()=>{U===1&&(B.value=!0)},2e3)}),(e,p)=>h?(j(),$("div",{key:0,id:f.element.id,class:"w-100"},[fe($e,{id:f.element.id,code:u(H)},null,8,["id","code"])],8,We)):W?(j(),$("div",Ke,[fe(Je,{thumbnail:T.value,fallback:g.value,url:X.value,properties:n.value,"file-id":C.value,"video-id":f.element.id,"check-step":b.value},null,8,["thumbnail","fallback","url","properties","file-id","video-id","check-step"])])):(j(),$("figure",{key:2,class:_e(["video-container",[u(N),te?"youtube":"","figure"]])},[B.value?ye("",!0):(j(),$("span",{key:0,id:f.element.id,onClick:F,class:"w-100"},[le(K("div",{ref_key:"thumbnailContainer",ref:V,style:se({background:R.value?`url(${R.value}) no-repeat center center`:null,backgroundSize:"cover",paddingBottom:`${u(Y)}%`}),onClick:F,class:"w-100"},null,4),[[u(Ie),A]])],8,Ge)),B.value?(j(),$("div",{key:1,id:f.element.id,class:"w-100"},[K("div",{class:"iframe-container",style:se({paddingBottom:`${u(Y)}%`})},[P.value?(j(),$("iframe",{src:P.value,allow:"autoplay",title:"player",allowfullscreen:"",key:u(a),loading:"lazy"},null,8,Xe)):(j(),$("p",Ye))],4)],8,Qe)):ye("",!0)],2))}});const dt=je(Ze,[["__scopeId","data-v-afee2a6c"]]);export{dt as default};
